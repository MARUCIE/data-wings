# Data Wings 产品需求文档（PRD）

**版本**: v1.0
**日期**: 2025-01-28
**作者**: 产品经理
**状态**: 初稿

---

## 1. 产品概述

### 1.1 产品愿景

**让每个人都能用自然语言洞察数据价值**

Data Wings 致力于成为 AI-Native 的开源数据分析平台，通过自然语言交互降低数据分析门槛，让业务人员无需依赖数据团队即可获取洞察，同时为技术团队提供灵活可扩展的分析引擎。

### 1.2 目标用户（Persona）

| 角色 | 描述 | 核心诉求 | 痛点 |
|------|------|----------|------|
| **业务分析师** | 负责业务数据分析，具备基础 SQL 能力 | 快速获取业务指标，自主完成分析 | 依赖数据团队排期，分析周期长 |
| **产品经理** | 关注用户行为和产品指标 | 实时了解功能效果，验证假设 | 埋点复杂，取数困难 |
| **增长运营** | 负责用户增长和留存 | 发现增长机会，优化转化漏斗 | 缺乏自动化洞察能力 |
| **数据工程师** | 搭建数据基础设施 | 低维护成本，高扩展性 | 商业产品锁定，定制化困难 |
| **CTO/技术负责人** | 技术选型决策者 | 数据安全，成本可控，自主可控 | 国外产品合规风险，私有化成本高 |

### 1.3 核心价值主张

1. **AI 原生**: 自然语言查询替代 SQL，自动生成洞察报告
2. **零门槛接入**: Auto-Capture 自动埋点，5 分钟完成数据接入
3. **开源自主**: 核心引擎 MIT 开源，避免厂商锁定
4. **国产化适配**: 支持 DeepSeek/Qwen 等国产 LLM，满足私有化部署需求
5. **合规内置**: 预置业财税合规分析模板，开箱即用

### 1.4 与竞品的差异化

| 维度 | Data Wings | 神策/GrowingIO | Amplitude | PostHog |
|------|------------|----------------|-----------|---------|
| AI 能力 | 核心能力，NL2Analytics | 辅助功能 | AI 驱动洞察 | 基础 AI |
| 开源策略 | 核心开源 (MIT) | 闭源 | 闭源 | 开源 (MIT) |
| 国产 LLM | 原生支持 | 不支持 | 不支持 | 不支持 |
| 自动埋点 | 内置 Auto-Capture | 需配置 | 需配置 | 内置 |
| 合规模板 | 业财税预置 | 通用 | 通用 | 通用 |
| 私有化 | 原生支持 | 支持（高价） | 不支持 | 支持 |

---

## 2. 范围定义

### 2.1 核心功能（Must Have / P0）

| 功能模块 | 功能点 | 说明 |
|----------|--------|------|
| **数据接入** | SDK 埋点 | Web/iOS/Android/小程序 SDK |
| | Auto-Capture | 自动采集点击、页面访问等基础事件 |
| | 数据导入 | 支持 CSV、API、数据库导入 |
| **事件分析** | 事件趋势 | 单事件/多事件趋势分析 |
| | 漏斗分析 | 转化漏斗构建与分析 |
| | 留存分析 | N日留存、自定义留存 |
| | 用户路径 | 行为路径可视化 |
| **AI 分析** | 自然语言查询 | 用自然语言提问，返回分析结果 |
| | 自动洞察 | 自动发现数据异常和增长机会 |
| **可视化** | 仪表盘 | 自定义仪表盘，拖拽式布局 |
| | 图表组件 | 折线图、柱状图、饼图、表格等 |

### 2.2 重要功能（Should Have / P1）

| 功能模块 | 功能点 | 说明 |
|----------|--------|------|
| **高级分析** | 分群分析 | 用户分群与对比分析 |
| | 归因分析 | 多触点归因模型 |
| | A/B 测试 | 实验分组与效果分析 |
| **AI 增强** | 预测分析 | 流失预测、LTV 预测 |
| | 异常检测 | 指标异常自动告警 |
| | 智能报告 | 自动生成周报/月报 |
| **协作** | 报告分享 | 仪表盘/报告链接分享 |
| | 权限管理 | 基于角色的访问控制 |
| **合规模板** | 业财税模板 | 预置合规分析场景 |

### 2.3 可选功能（Could Have / P2）

| 功能模块 | 功能点 | 说明 |
|----------|--------|------|
| **高级功能** | 实时分析 | 秒级数据更新 |
| | SQL 编辑器 | 高级用户自定义 SQL |
| | 数据仓库集成 | Snowflake/BigQuery 等集成 |
| **扩展能力** | 插件市场 | 第三方分析插件 |
| | API 网关 | 开放 API 能力 |
| **企业功能** | SSO 集成 | LDAP/SAML/OAuth |
| | 审计日志 | 操作审计与合规 |

### 2.4 非目标（Scope Out）

- CDP（客户数据平台）完整能力
- 营销自动化（MA）
- 实时推荐系统
- 数据治理平台
- ETL 工具

---

## 3. 功能详细说明（P0 功能）

### 3.1 数据接入 - SDK 埋点

**用户故事**:
> As a 数据工程师
> I want 快速集成数据采集 SDK
> So that 产品数据能够被自动采集和分析

**功能描述**:
- 提供多端 SDK：Web (JavaScript)、iOS (Swift)、Android (Kotlin)、小程序 (微信/支付宝)
- 支持事件追踪（track）、用户标识（identify）、属性设置（setUserProperties）
- 支持离线缓存与批量上报
- 数据压缩与加密传输

**验收标准（AC）**:
1. 集成代码少于 10 行即可完成初始化
2. SDK 体积：Web < 30KB (gzip)，移动端 < 500KB
3. 数据延迟：从采集到可查询 < 5 分钟
4. 支持自定义事件属性，单事件属性 < 100 个
5. 提供数据校验工具，实时验证埋点正确性

**技术依赖**:
- 数据接收服务（Kafka/Pulsar）
- 数据存储（ClickHouse）
- CDN 分发

### 3.2 数据接入 - Auto-Capture

**用户故事**:
> As a 产品经理
> I want 无需手动埋点即可采集基础用户行为
> So that 我能快速开始分析而不等待开发排期

**功能描述**:
- 自动采集：页面访问（pageview）、元素点击（click）、表单提交（submit）
- 智能元素识别：基于 CSS 选择器、XPath、视觉特征自动标记元素
- 可视化圈选：在页面上直接选择元素定义事件
- 支持开关控制，可随时启用/禁用

**验收标准（AC）**:
1. 集成后 0 配置即可采集 pageview 和 click
2. 元素识别准确率 > 95%
3. 可视化圈选支持 Chrome/Firefox/Safari
4. 不影响页面加载性能，FCP 增量 < 50ms
5. 支持按域名/页面/元素类型过滤采集

**技术依赖**:
- DOM 监听与事件捕获
- 元素指纹算法
- Chrome Extension（圈选工具）

### 3.3 事件分析 - 漏斗分析

**用户故事**:
> As a 增长运营
> I want 分析用户从访问到转化的完整路径
> So that 我能发现转化瓶颈并优化

**功能描述**:
- 自定义漏斗步骤（最多 10 步）
- 支持时间窗口设置（1小时 ~ 30天）
- 支持按属性分组对比（渠道、设备、地区等）
- 转化率趋势分析
- 流失用户下钻

**验收标准（AC）**:
1. 漏斗创建 < 30 秒（拖拽式配置）
2. 查询响应时间 < 3 秒（千万级数据）
3. 支持导出漏斗各阶段用户列表
4. 支持保存漏斗为看板组件
5. 支持漏斗对比（A/B 组、时间段对比）

**技术依赖**:
- 窗口函数计算引擎
- 用户行为序列存储
- 实时/离线混合计算

### 3.4 事件分析 - 留存分析

**用户故事**:
> As a 产品经理
> I want 了解用户的留存情况和生命周期
> So that 我能评估产品的用户粘性

**功能描述**:
- 标准 N 日留存曲线
- 自定义留存事件（初始事件 + 回访事件）
- 支持用户分群留存对比
- 留存同期群分析
- 生命周期价值预估

**验收标准（AC）**:
1. 支持 1-90 日留存分析
2. 查询响应时间 < 5 秒
3. 支持按周/月粒度聚合
4. 支持导出留存数据
5. 自动计算留存率置信区间

**技术依赖**:
- 同期群计算逻辑
- 时间序列聚合
- 统计显著性计算

### 3.5 AI 分析 - 自然语言查询（NL2Analytics）

**用户故事**:
> As a 业务分析师
> I want 用自然语言描述分析需求
> So that 我不需要写 SQL 就能获取数据洞察

**功能描述**:
- 自然语言输入框，支持中英文
- 理解业务术语（转化率、留存、DAU 等）
- 自动生成查询并返回可视化结果
- 支持追问和结果调整
- 查询历史和收藏

**验收标准（AC）**:
1. 常见分析场景识别准确率 > 90%
2. 查询生成延迟 < 2 秒
3. 支持至少 50 种标准分析模式
4. 提供查询建议和自动补全
5. 支持多轮对话式分析

**示例查询**:
- "过去 7 天的日活趋势"
- "注册到首次付费的转化率是多少"
- "哪个渠道的用户留存最高"
- "本周相比上周，核心指标有什么变化"

**技术依赖**:
- LLM 接口（OpenAI/DeepSeek/Qwen）
- 语义解析与意图识别
- Schema 映射与查询生成
- 结果可视化渲染

### 3.6 AI 分析 - 自动洞察

**用户故事**:
> As a 运营负责人
> I want 系统自动发现数据中的异常和机会
> So that 我不会错过重要的业务信号

**功能描述**:
- 自动监控核心指标
- 异常检测与告警（同比/环比异常）
- 增长机会识别（高价值用户特征、高转化路径）
- 每日/每周洞察摘要
- 洞察推送（邮件/钉钉/飞书）

**验收标准（AC）**:
1. 异常检测召回率 > 85%，精确率 > 70%
2. 洞察生成延迟 < 1 小时（每日凌晨批处理）
3. 支持自定义监控指标
4. 支持设置告警阈值
5. 洞察报告可导出为 PDF/PNG

**技术依赖**:
- 时间序列异常检测算法
- LLM 洞察生成
- 消息推送服务

### 3.7 可视化 - 仪表盘

**用户故事**:
> As a 数据分析师
> I want 创建和管理数据仪表盘
> So that 团队能实时了解业务状况

**功能描述**:
- 拖拽式仪表盘编辑器
- 丰富的图表组件库
- 全局筛选器（时间、用户属性）
- 自动刷新与定时邮件
- 响应式布局（PC/移动端适配）

**验收标准（AC）**:
1. 仪表盘创建 < 2 分钟（从空白到完成）
2. 单仪表盘支持 50+ 组件
3. 页面加载时间 < 3 秒
4. 支持仪表盘模板
5. 支持嵌入外部系统（iframe）

**技术依赖**:
- 前端拖拽框架
- 图表库（ECharts/Recharts）
- 响应式布局引擎

---

## 4. AI 能力规格

### 4.1 自然语言查询（NL2Analytics）

**架构设计**:

```
用户输入 -> 意图识别 -> Schema映射 -> 查询生成 -> 执行优化 -> 结果渲染
                |
            上下文管理（多轮对话）
```

**LLM 配置**:

| 参数 | 推荐值 | 说明 |
|------|--------|------|
| 模型 | DeepSeek-V3 / Qwen-Max / GPT-4o | 根据部署环境选择 |
| Temperature | 0.1 | 保证查询稳定性 |
| Max Tokens | 2048 | 查询生成足够 |
| Timeout | 10s | 用户体验阈值 |

**Schema 映射策略**:
- 维护业务术语词典（DAU = 日活跃用户数）
- 自动推断时间范围（"上周" -> 7天前到今天）
- 实体识别（渠道名、事件名、属性名）

### 4.2 自动洞察生成

**洞察类型**:

| 类型 | 触发条件 | 示例 |
|------|----------|------|
| 异常检测 | 指标偏离 > 2 sigma | "今日注册数下降 35%，创 30 日新低" |
| 趋势变化 | 连续 3 日单向变化 | "付费率连续 5 日上升，累计提升 12%" |
| 对比洞察 | 分群差异显著 | "iOS 用户留存比 Android 高 20%" |
| 归因发现 | 高影响因子 | "来自小红书渠道的用户 LTV 是平均值的 2.3 倍" |

### 4.3 预测分析

**支持场景**:
- 用户流失预测（7日/30日流失概率）
- LTV 预测（基于早期行为预测生命周期价值）
- 指标预测（基于历史数据预测未来趋势）

**模型选型**:
- 流失预测：XGBoost / LightGBM
- LTV 预测：Lifetimes / BG-NBD
- 趋势预测：Prophet / ARIMA

### 4.4 异常检测

**算法策略**:

| 场景 | 算法 | 参数 |
|------|------|------|
| 短期异常 | 动态阈值（同比/环比） | 阈值 = 均值 +/- 2 sigma |
| 趋势突变 | CUSUM 检测 | 灵敏度可调 |
| 季节性异常 | STL 分解 + 残差检测 | 周/月周期 |
| 多维异常 | Isolation Forest | contamination=0.1 |

---

## 5. 非功能需求

### 5.1 性能指标

| 指标 | 目标值 | 测量方法 |
|------|--------|----------|
| 查询响应时间（P95） | < 3 秒 | 千万级数据查询 |
| 页面加载时间（P95） | < 2 秒 | LCP 指标 |
| SDK 数据延迟 | < 5 分钟 | 从采集到可查询 |
| 系统可用性 | > 99.9% | 年度 SLA |
| 数据准确性 | > 99.99% | 抽样校验 |

### 5.2 安全合规

| 要求 | 实现方式 |
|------|----------|
| 数据加密 | 传输 TLS 1.3，存储 AES-256 |
| 访问控制 | RBAC + 数据行级权限 |
| 审计日志 | 全操作记录，保留 1 年 |
| 数据脱敏 | PII 字段自动脱敏 |
| GDPR 合规 | 数据删除 API，导出 API |
| 等保 2.0 | 三级等保适配 |

### 5.3 可扩展性

| 维度 | 目标 |
|------|------|
| 数据规模 | 支持 PB 级数据存储 |
| 并发用户 | 支持 1000+ 同时在线 |
| 事件吞吐 | 支持 100K+ QPS 数据写入 |
| 水平扩展 | 计算/存储分离，弹性扩缩 |

---

## 6. 成功指标（KPI）

### 6.1 北极星指标

**周活跃查询用户数（WAU-Query）**

定义：每周至少发起 1 次数据查询的唯一用户数

目标：
- MVP 阶段：100 WAU
- V1.0 阶段：1,000 WAU
- V2.0 阶段：10,000 WAU

### 6.2 过程指标

| 指标 | 定义 | MVP 目标 | V1.0 目标 |
|------|------|----------|-----------|
| 接入转化率 | 注册 -> 完成数据接入 | > 30% | > 50% |
| 查询成功率 | 查询返回结果 / 总查询 | > 90% | > 95% |
| NL 查询占比 | NL 查询 / 总查询 | > 20% | > 40% |
| 仪表盘创建数 | 平均每用户创建仪表盘数 | > 2 | > 5 |
| NPS | 净推荐值 | > 30 | > 50 |
| 付费转化率 | 免费 -> 付费 | > 2% | > 5% |

---

## 7. 风险与依赖

### 7.1 技术风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| NL2SQL 准确率不达标 | 中 | 高 | 预置常见查询模板，人工反馈优化 |
| 大数据量查询性能 | 中 | 高 | ClickHouse 分区优化，预聚合 |
| 多端 SDK 兼容性 | 中 | 中 | 渐进式发布，灰度测试 |
| LLM API 稳定性 | 低 | 高 | 多 LLM 供应商，本地模型备份 |

### 7.2 市场风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| 竞品快速跟进 AI 能力 | 高 | 中 | 深耕垂直场景，建立数据壁垒 |
| 开源社区活跃度不足 | 中 | 中 | 早期种子用户运营，贡献者激励 |
| 企业付费意愿低 | 中 | 高 | 清晰的开源/商业边界，价值证明 |

### 7.3 资源依赖

| 依赖 | 类型 | 状态 | 负责人 |
|------|------|------|--------|
| ClickHouse 集群 | 基础设施 | 待部署 | 运维团队 |
| LLM API 额度 | 外部服务 | 已申请 | AI 团队 |
| 设计资源 | 人力 | 需协调 | 设计团队 |
| 前端开发 | 人力 | 进行中 | 前端团队 |

---

## 8. 里程碑规划

### 8.1 MVP 范围（Month 1-2）

**目标**: 验证核心价值，获取种子用户反馈

**功能范围**:
- Web SDK + Auto-Capture
- 事件趋势分析
- 基础漏斗分析
- 自然语言查询（基础版）
- 简易仪表盘

**交付标准**:
- 5 分钟完成接入
- 支持 10 万日事件量
- NL 查询覆盖 20 种场景

### 8.2 V1.0 范围（Month 3-4）

**目标**: 功能完备，开放公测

**新增功能**:
- 全端 SDK（iOS/Android/小程序）
- 留存分析 + 用户路径
- 自动洞察
- 权限管理
- 业财税合规模板

**交付标准**:
- 支持 1000 万日事件量
- NL 查询覆盖 50 种场景
- 洞察准确率 > 80%

### 8.3 V2.0 愿景（Month 5-8）

**目标**: 企业级能力，商业化

**新增功能**:
- 预测分析
- A/B 测试
- 归因分析
- SSO / 审计日志
- 数据仓库集成
- 开放 API

**交付标准**:
- 支持 1 亿日事件量
- 企业级 SLA
- 完善的商业版功能

---

## 附录

### A. 术语表

| 术语 | 定义 |
|------|------|
| DAU | Daily Active Users，日活跃用户 |
| MAU | Monthly Active Users，月活跃用户 |
| LTV | Lifetime Value，用户生命周期价值 |
| ARPU | Average Revenue Per User，平均每用户收入 |
| NL2Analytics | Natural Language to Analytics，自然语言转分析 |

### B. 参考竞品

- 神策数据：https://www.sensorsdata.cn/
- GrowingIO：https://www.growingio.com/
- Amplitude：https://amplitude.com/
- PostHog：https://posthog.com/
- Mixpanel：https://mixpanel.com/

---

猪哥云（四川）网络科技有限公司 | 合规网 www.hegui.com
猪哥云-数据产品部-Maurice | maurice_wen@proton.me
2025 猪哥云-灵阙企业级智能体平台
